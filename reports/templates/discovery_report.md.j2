## Discovered Application Types

{# to get total apps we subtract 2 from the total to account for built-in "all" and "ungrouped" #}
**Total Number of Discovered Applications**: {{ groups | dict2items | length() - 2 }}

| Application Name | Number of Associated Servers |
| --- | --- |
{% for app in groups | dict2items | sort(attribute='key') %}
{% if app.key != 'all' and app.key != 'ungrouped' %}
{# we do the regex_replace stuff to fix any groups that get transformed due to invalid group names #}
| [{{ app.key | regex_replace('_', ' ') }}](#{{ app.key | regex_replace('_', ' ') | regex_replace('\s', '-') | lower() }}) | {{ app.value | length() }} |
{% endif %}
{% endfor %}

## Servers By Application Type

{% for app in groups | dict2items | sort(attribute='key') %}
{% if app.key != 'all' and app.key != 'ungrouped' and app.value | length > 0 %}
### {{ app.key | regex_replace('_', ' ') }}

There {% if app.value | length > 1 %}were **{{ app.value | length }} servers**{% else %}was **1 server**{% endif %} found to be running {{ app.key | regex_replace('_', ' ') }}:

| Hostname | FQDN | IPv4 Address |
| --- | --- | --- |
{% for host in app.value | sort %}
| [{{ host | lower() }}](#{{ host | regex_replace('-','-2d-') | lower }}) | {{ hostvars[host]['discovered_facts']['fqdn'] }} | {{ hostvars[host]['discovered_facts']['default_ipv4']['address'] }} |
{% endfor %}


{% endif %}
{% endfor %}


## All Discovered Servers

{# following line does -1 to account for localhost target #}
**Total number of servers discovered:** {{ groups['all'] | length - 1 }}

| Hostname | FQDN | IPv4 Address |
| --- | --- | --- |
{% for host in groups['all'] | sort %}
{% if host != 'localhost' %}
| [{{ host | lower() }}](#{{ host | regex_replace('-', '-2d-') | lower }}) | {{ hostvars[host]['discovered_facts']['fqdn'] | lower() }} | {{ hostvars[host]['discovered_facts']['default_ipv4']['address'] }} |
{% endif %}
{% endfor %}


## Discovered Host Details

{% for host in groups['all'] %}
{% if host != 'localhost' %}
### {{ host | lower() }}
#### {{ host | lower() }}'s Server Details

| Hostname | FQDN | IPv4 Address |
| --- | --- | --- |
| {{ host | lower() }} | {{ hostvars[host]['discovered_facts']['fqdn'] | lower() }} | {{ hostvars[host]['discovered_facts']['default_ipv4']['address'] }} |

#### {{ host | lower() }}'s System Resources

| CPU Count | CPU Cores | CPU Type | RAM (MB) | RAM (GB) | Swap (MB) | Swap (GB) |
| --- | --- | --- | --- | --- | --- | --- |
| {{ hostvars[host]['discovered_facts']['processor_count'] }} | {{ hostvars[host]['discovered_facts']['processor_cores'] }} | {{ hostvars[host]['discovered_facts']['processor'] }} | {{ hostvars[host]['discovered_facts']['memtotal_mb'] }} | {{ hostvars[host]['discovered_facts']['memtotal_mb'] / 1024 }} | {{ hostvars[host]['discovered_facts']['swaptotal_mb'] }} | {{ hostvars[host]['discovered_facts']['swaptotal_mb'] / 1024 }} |


#### {{ host | lower() }}'s Storage Resources

| Mount Point | Disk Size Total (MB) | Disk Size Total (GB) | Disk Size Free (MB) | Disk Size Free (GB) | Filesystem Type | System Device |
| --- | --- | --- | --- | --- | --- | --- |
{% for mount in hostvars[host]['discovered_facts']['mounts'] | sort(attribute='mount') %}
{% if 'proc' not in mount['fstype'] and 'nfs' not in mount['fstype'] %}
| {{ mount['mount'] }} | {{ mount['size_total'] | default(0) | float | human_readable(unit='M') }} | {{ mount['size_total'] | default(0) | float | human_readable(unit='G') }} | {{ mount['size_available'] | default(0) | float | human_readable(unit='M') }} | {{ mount['size_available'] | default(0) | human_readable(unit='G') }} | {{ mount['fstype'] }} | {{ mount['device'] }} |
{% endif %}
{% endfor %}


#### {{ host | lower() }}'s Local Groups
| Group | GID | Members |
| --- | --- | --- |
{% for g in hostvars[host]['discovered_facts']['local_groups'] | sort(attribute='group') %}
| {{ g.group }} | {{ g.gid }} | {% for m in g.members | sort() %}{{ m }}<br/>{% endfor %} |
{% endfor %}


#### {{ host | lower() }}'s Local Users
| User | UID | GID | Home | Shell | Comment |
| --- | --- | --- | --- | --- | --- |
{% for u in hostvars[host]['discovered_facts']['local_users'] | sort(attribute='user') %}
| {{ u.user }} | {{ u.uid }} | {{ u.gid }} | {{ u.home }} | {{ u.shell }} | {{ u.comment }} |
{% endfor %}


#### {{ host | lower() }}'s Environment Variables
| Variable | Value |
| --- | --- |
{% for v in hostvars[host]['discovered_facts']['env'] | dict2items | sort(attribute='key') %}
| {{ v.key }} | {{ v.value }} |
{% endfor %}

#### {{ host | lower() }}'s Cron Schedules
| Path | Command | Minute | Hour | Day of Month | Month | Day of Week |
| --- | --- | --- | --- | --- | --- | --- |
{% for p in hostvars[host]['discovered_facts']['cron']['files'] | sort(attribute='path') %}
{# following condition to prevent empty configs from being reported #}
{% if p.data.schedules | length > 0 and p.data.variables | length < 1 %}
{% for s in p.data.schedules %}
| {{ p.path }} | {{ s.command }} | {{ s.minute }} | {{ s.hour }} | {{ s.day_of_month }} | {{ s.month }} | {{ s.day_of_week }} |
{% endfor %}
{% endif %}
{% endfor %}


{% if hostvars[host]['discovered_facts']['cron']['files'] | json_query('[*].data.variables[*]') flatten | length > 0 %}
#### {{ host | lower() }}'s Cron Scripts
| Path | Shell | Variables | Script Content |
| --- | --- | --- | --- |
{# TODO: Handle the files that are actually scripts instead of schedules #}
{% endif %}




{% endif %}
{% endfor %}
